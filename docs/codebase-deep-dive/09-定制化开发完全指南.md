# 09 - å®šåˆ¶åŒ–å¼€å‘å®Œå…¨æŒ‡å—

> **é˜…è¯»æ—¶é—´**: 45-60 åˆ†é’Ÿ
> **éš¾åº¦çº§åˆ«**: â­â­â­â­â˜† å®æˆ˜

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

- [1. åˆ›å»ºè‡ªå®šä¹‰ Agent](#1-åˆ›å»ºè‡ªå®šä¹‰-agent)
- [2. åˆ›å»ºè‡ªå®šä¹‰ Workflow](#2-åˆ›å»ºè‡ªå®šä¹‰-workflow)
- [3. åˆ›å»ºè‡ªå®šä¹‰ Module](#3-åˆ›å»ºè‡ªå®šä¹‰-module)
- [4. ä¿®æ”¹ç°æœ‰ç»„ä»¶](#4-ä¿®æ”¹ç°æœ‰ç»„ä»¶)
- [5. ä¼ä¸šçº§å®šåˆ¶](#5-ä¼ä¸šçº§å®šåˆ¶)

---

## 1. åˆ›å»ºè‡ªå®šä¹‰ Agent

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ BMB Builderï¼ˆæ¨èï¼‰

```bash
# 1. å¯åŠ¨ BMB Builder
/bmad:bmb:agents:bmad-builder

# 2. é€‰æ‹©åˆ›å»º Agent
*create-agent

# 3. æŒ‰æç¤ºå®Œæˆé…ç½®
# - Agent åç§°
# - è§’è‰²å®šä½
# - æ‰€å±æ¨¡å—
# - å·¥ä½œæµé…ç½®
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º

**æ¨¡æ¿æ–‡ä»¶**: `src/modules/{module}/agents/custom-agent.agent.yaml`

```yaml
agent:
  metadata:
    id: "bmad/{module}/agents/custom-agent.md"
    name: "AgentName"
    title: "Agent Title"
    icon: "ğŸ¯"
    module: "{module}"

  persona:
    role: "Your Role + Expertise"
    identity: "Background and experience description"
    communication_style: "How you communicate"
    principles:
      - "Core principle 1"
      - "Core principle 2"

  critical_actions:
    - "Load into memory {project-root}/bmad/{module}/config.yaml"
    - "ALWAYS communicate in {communication_language}"

  menu:
    - trigger: "main-action"
      workflow: "{project-root}/bmad/{module}/workflows/main/workflow.yaml"
      description: "Main workflow description"

  prompts: []
```

---

## 2. åˆ›å»ºè‡ªå®šä¹‰ Workflow

### åŸºæœ¬ç»“æ„

**æ–‡ä»¶**: `workflows/{name}/workflow.yaml`

```yaml
name: "workflow-name"
description: "Workflow description"
author: "Your Name"

# é…ç½®æº
config_source: "{project-root}/bmad/{module}/config.yaml"
project_name: "{config_source}:project_name"
output_folder: "{config_source}:output_folder"

# ç»„ä»¶
installed_path: "{project-root}/bmad/{module}/workflows/{name}"
instructions: "{installed_path}/instructions.md"
template: "{installed_path}/template.md"

# è¾“å‡º
default_output_file: "{output_folder}/output.md"

standalone: true
```

**æŒ‡ä»¤æ–‡ä»¶**: `workflows/{name}/instructions.md`

```xml
<invoke-task task="{project-root}/bmad/core/tasks/workflow.xml"/>

## Step 1: Initialize

<action>Load configuration and set context</action>

## Step 2: Process

<action>Main processing logic</action>

<template-output section="main">
Generate main content here
</template-output>

## Step 3: Complete

<action>Finalize and save output</action>
```

---

## 3. åˆ›å»ºè‡ªå®šä¹‰ Module

### ç›®å½•ç»“æ„

```
src/modules/{module-name}/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ agent1.agent.yaml
â”‚   â””â”€â”€ agent2.agent.yaml
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ workflow1/
â”‚   â”‚   â”œâ”€â”€ workflow.yaml
â”‚   â”‚   â”œâ”€â”€ instructions.md
â”‚   â”‚   â””â”€â”€ template.md
â”‚   â””â”€â”€ workflow2/
â”œâ”€â”€ _module-installer/
â”‚   â””â”€â”€ install-config.yaml
â””â”€â”€ README.md
```

### å®‰è£…é…ç½®

**æ–‡ä»¶**: `_module-installer/install-config.yaml`

```yaml
code: "module-code"
name: "Module Name"
default_selected: false

prompt:
  - "Module description and introduction"

# é…ç½®å˜é‡
variable_name:
  prompt: "Question to user?"
  default: "default-value"
  result: "{value}"
```

---

## 4. ä¿®æ”¹ç°æœ‰ç»„ä»¶

### Update-Safe å®šåˆ¶

```bash
# 1. åˆ›å»ºå®šåˆ¶ç›®å½•
mkdir -p bmad/_cfg/agents/

# 2. å¤åˆ¶è¦ä¿®æ”¹çš„ Agent
cp bmad/bmm/agents/pm.agent.yaml bmad/_cfg/agents/pm-custom.yaml

# 3. ç¼–è¾‘å®šåˆ¶ç‰ˆæœ¬
# åªä¿®æ”¹éœ€è¦æ”¹çš„éƒ¨åˆ†

# 4. ç³»ç»Ÿè‡ªåŠ¨åŠ è½½å®šåˆ¶ç‰ˆæœ¬
```

**ä¼˜åŠ¿**:
- âœ… æ›´æ–°æ—¶ä¸ä¸¢å¤±å®šåˆ¶
- âœ… å¯ä»¥å›æ»šåˆ°å®˜æ–¹ç‰ˆæœ¬
- âœ… å›¢é˜Ÿå…±äº«å®šåˆ¶é…ç½®

---

## 5. ä¼ä¸šçº§å®šåˆ¶

### åœºæ™¯ä¸€ï¼šç²¾ç®€ç‰ˆæœ¬

**ç§»é™¤ä¸éœ€è¦çš„æ¨¡å—**:

```bash
# åªå®‰è£…æ ¸å¿ƒ + BMM
npx bmad-method@alpha install
# é€‰æ‹©: Core + BMM only
```

**ç§»é™¤ä¸éœ€è¦çš„ Agent**:

```javascript
// ä¿®æ”¹å®‰è£…é…ç½®
// src/modules/bmm/_module-installer/install-config.yaml
agents_to_install:
  - pm
  - architect
  - developer
  # æ³¨é‡Šæ‰ä¸éœ€è¦çš„
  # - ux-designer
  # - tech-writer
```

### åœºæ™¯äºŒï¼šä¼ä¸šæµç¨‹å®šåˆ¶

**æ·»åŠ ä¼ä¸šç‰¹å®šå·¥ä½œæµ**:

```yaml
# src/modules/enterprise/workflows/security-review/workflow.yaml
name: "security-review"
description: "Enterprise security compliance review"

# é›†æˆä¼ä¸šå·¥å…·
integrations:
  - jira: "{enterprise_jira_url}"
  - confluence: "{enterprise_confluence_url}"
  - security_tool: "{enterprise_security_scanner}"
```

### åœºæ™¯ä¸‰ï¼šå¤šè¯­è¨€å›¢é˜Ÿ

```yaml
# config.yaml
communication_language: "zh-CN"  # ä¸­æ–‡äº¤æµ
document_output_language: "en-US"  # è‹±æ–‡è¾“å‡º

# Agent è‡ªåŠ¨é€‚åº”
persona:
  communication_style: "ç”¨ä¸­æ–‡äº¤æµï¼Œä¸“ä¸šä¸”ç›´æ¥"
```

---

## 6. å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹ï¼šåˆ›å»ºæ•°æ®åˆ†æ Agent

```yaml
agent:
  metadata:
    id: "bmad/custom/agents/data-analyst.md"
    name: "Dana"
    title: "Data Analyst"
    icon: "ğŸ“Š"
    module: "custom"

  persona:
    role: "æ•°æ®åˆ†æå¸ˆ + SQLä¸“å®¶"
    identity: "5å¹´æ•°æ®åˆ†æç»éªŒï¼Œç²¾é€šSQLã€Pythonå’Œæ•°æ®å¯è§†åŒ–"
    communication_style: "æ•°æ®é©±åŠ¨ï¼Œç”¨å›¾è¡¨è¯´è¯"
    principles:
      - "æ•°æ®ä¸è¯´è°ï¼Œä½†éœ€è¦æ­£ç¡®è§£è¯»"
      - "å¯è§†åŒ–ä¼˜å…ˆï¼Œç„¶åè§£é‡Š"

  menu:
    - trigger: "analyze-metrics"
      workflow: "{project-root}/bmad/custom/workflows/metrics/workflow.yaml"
      description: "åˆ†æäº§å“æŒ‡æ ‡"

    - trigger: "user-cohort"
      workflow: "{project-root}/bmad/custom/workflows/cohort/workflow.yaml"
      description: "ç”¨æˆ·ç¾¤ç»„åˆ†æ"
```

---

## 7. æµ‹è¯•ä¸éªŒè¯

```bash
# 1. Schema éªŒè¯
npm run validate:schemas

# 2. æ„å»º
npm run build

# 3. æœ¬åœ°æµ‹è¯•
cd test-project
npx bmad-method@alpha install

# 4. åŠŸèƒ½æµ‹è¯•
# åŠ è½½ Agent å¹¶æµ‹è¯•æ‰€æœ‰ menu items
```

---

## 8. æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

- ä½¿ç”¨ Update-Safe å®šåˆ¶ç³»ç»Ÿ
- ä¿æŒä¸å®˜æ–¹è§„èŒƒä¸€è‡´
- ç¼–å†™æ¸…æ™°çš„æ–‡æ¡£
- ç‰ˆæœ¬æ§åˆ¶å®šåˆ¶é…ç½®

### âŒ é¿å…çš„åšæ³•

- ç›´æ¥ä¿®æ”¹æºæ–‡ä»¶
- è·³è¿‡ Schema éªŒè¯
- ç¡¬ç¼–ç è·¯å¾„
- å¿½ç•¥å˜é‡ç³»ç»Ÿ

---

## 9. å¿«é€Ÿå‚è€ƒ

### Agent å¿…éœ€å­—æ®µ

```yaml
metadata: {id, name, title, icon, module?}
persona: {role, identity, communication_style, principles}
menu: [{trigger, description, workflow/action/...}]
```

### Workflow å¿…éœ€å­—æ®µ

```yaml
name, description, config_source, instructions, default_output_file
```

### å˜é‡ç³»ç»Ÿ

```
{project-root} - é¡¹ç›®æ ¹ç›®å½•
{output_folder} - è¾“å‡ºæ–‡ä»¶å¤¹
{config_source}:var - ä»é…ç½®è¯»å–
{installed_path} - å½“å‰è·¯å¾„
```

---

## 10. è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹ [03-ä»£ç†ç³»ç»Ÿæ·±åº¦è§£æ](./03-ä»£ç†ç³»ç»Ÿæ·±åº¦è§£æ.md)
- ğŸ”§ ä½¿ç”¨ BMB Builder å·¥ä½œæµ
- ğŸ’¬ å‚è€ƒç°æœ‰ Agent å’Œ Workflow
- ğŸ› è¿è¡Œ `npm run validate:schemas` æ£€æŸ¥é”™è¯¯

---

**ä¸‹ä¸€æ­¥**: [10 - ä¼ä¸šå†…éƒ¨å®šåˆ¶æ–¹æ¡ˆ](./10-ä¼ä¸šå†…éƒ¨å®šåˆ¶æ–¹æ¡ˆ.md)
